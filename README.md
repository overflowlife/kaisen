# kaisen
kaisen game

## 概要
下記リンク先（現在リンク切れ）の「海戦ゲーム」を再現した（そして発展させる予定の）、.net core 1.0で構築されたコンソールアプリケーション（TCPクライアント/サーバ）です。
http://battleship.geo.jp/

　海戦ゲームは、プレイヤー2名が所定の範囲内に艦船を3隻配置したうえで交互に砲撃や移動といった行動を行い、すべての敵艦船を破壊するゲームです。
 敵艦船に直接砲撃を当てて（「直撃」させて）敵艦船の耐久値を減らすことによりゲームを直接的に進行させることができますが、そのほかにも砲撃の反応や相手の移動から得られるメッセージを読み解くことによってより有利にゲームを進めることができます。基本ルールについてはリンク先を参照してください。

## 使用方法
**特別に記載なき場合、ver.1.0現在の仕様です。仕様変更のある場合はリリースノートに記載しますが、順次こちらにも反映します。**
1. 対戦相手を確保し、ホスト/ゲストを決定し、両者はプログラムを起動します。
   **なお、自動応答ホストを使用する場合、ホスト側はアプリケーションを起動するだけで待ち受け（ポート番号19690）を開始します。**
1. 艦船を配置します。
   * 戦艦（耐久3）、駆逐艦（耐久2）、潜水艦（耐久1）それぞれの配置座標を、マップ内（0, 0～4, 4）に指示します。なお、艦種による耐久値以外の差はありません
1. 接続待ち受けポート番号もしくは接続先ホスト情報を指示します。
   * ホスト側は待ち受けポート番号を指示します。他アプリケーションと競合しないようにします。
   * ゲスト側は待ち受け中のホスト情報を指示します。待ち受け開始を確認してから接続します。
1. 接続が確立され、初期通信に成功したら、ゲーム開始です。先攻は常にゲストが握ります。
   * 砲撃（FiringRequest）：相手マップの指定座標を砲撃し（潜水艦はミサイルを発射します）、敵艦に直撃した場合には耐久値を1減らすことができます。マップ内の射程範囲（1隻以上の艦船の周囲9マス圏内）を指示できます。砲撃後の応答によって相手艦船の位置を絞り込むことができる場合があります。相手には砲撃指定座標が通知されます。
      * 直撃：砲撃時点で、砲撃指定座標に敵艦船が存在します（敵艦船1の位置を*特定*できます）。その砲撃で破壊した場合には、対象の艦種を把握できます。
      * ニアミス：砲撃時点で、砲撃指定座標周囲9マスより砲撃指定座標を除いた8マス中に敵艦船が1隻*以上*存在します。
      * 海に落ちた：砲撃時点で、砲撃指定座標周囲9マスに敵艦船が*1隻も*存在しません。
      * **注意したいことは、自身が砲撃すると相手にニアミス相当程度（砲撃地点の周囲9マスにあなたの艦船が1隻以上存在する）の情報を与えることです。**
   * 移動（MovingRequest）：友軍艦船を上下左右いずれかの方向に移動させます。相手には、移動した艦船と移動方向、移動距離が通知されます。
      * 移動艦船の存在する座標を指示した後、方向と移動量を指示します。
      * 移動方向は2, 4, 6, 8により指示します。これらはテンキーにおける5に対する方向として表現され、例えば移動方向4は左側を意味します。
      * 移動後の位置がマップ圏外、もしくは他友軍艦船と一致する位置になる場合には移動できません。
      * **注意したいことは、自身の移動により自身は何も情報を得ませんが、相手は移動方向と移動量に応じて自身の艦船1隻の位置を絞り込めることです。**
1. ゲーム終了の合意が取れたら、「終了」（ExitingRequest）を実行してください。


## 敵艦絞り込みサンプル
* 砲撃の場合
   * 敵艦すべて健在の状態から座標（2, 2）に砲撃し、ニアミス反応を得た。
      * あなたは、敵艦1隻以上が座標（1, 1）～（3, 1）、（1, 2）、（3, 2）、（1, 3）～（3, 3）の範囲に存在し、かつ座標（2, 2）に存在しないことを確定できます。
      * 相手は、あなたの艦船1隻以上が座標（1, 1）～(3, 1）、（1, 2）～(3, 2）、（1, 3）～(3, 3）の範囲に存在することを確定できます。
   * 敵艦（戦艦（耐久値3）、潜水艦（耐久値1））健在の状態から座標（2, 2）に砲撃し、直撃反応を得た。
      * あなたは、戦艦が座標（2, 2）に存在しかつ耐久値2になったことを確定できます。潜水艦については座標(2, 2）に存在しないことしか確定できません。
      * 相手は、通常の射撃と同等の情報を得ます。
* 移動の場合
   * 友軍艦船（潜水艦）健在の状態から潜水艦を8方向（上向き）に移動させた。
      * あなたは、何も情報を得られません。
      * 相手は、あなたの潜水艦が座標（0, 3）～（4, 4）のいずれにも存在しないことを確定できます。

## 自動応答ホスト仕様
現状自動応答ホストに設定されているプレイヤーは、以下のような射撃をします。移動はしません。

**射程範囲中、自分はなるべく情報を多く得、相手にはなるべく情報を与えないような評価値を持つ射撃位置を算出し、その地点に砲撃します。ただし、相手艦船の耐久値を削れる可能性のある射撃位置に対しては、その度合いにより評価値を上方修正します。**
